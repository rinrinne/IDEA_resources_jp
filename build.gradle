apply plugin: 'java'

defaultTasks 'jar'

sourceSets {
  main {
    resources {
      srcDir 'resources-ja'
    }
  }
}

task processResourceFiles() << {
  ["search", "messages"].each {src ->
      copy {
        from "target/" + src
        into "resources-ja/" + src
        rename '(.*).properties', '$1_ja.properties'
      }
  }
  ["fileTemplates", "inspectionDescriptions", "intentionDescriptions",
   "postfixTemplates", "tips"].each {src ->
    copy {
      from "target/" + src
      into "resources-ja/" + src + "_ja"
    }
  }
}

task processPropertiesFile << {
  sourceSets.each { s ->
    s.resources.srcDirs.each { d ->
      if (d.isDirectory()) {
        ant.native2ascii(
          src: "${d}",
          dest: "${s.output.resourcesDir}",
          includes: '**/*.properties',
          encoding: 'UTF-8'
        )
      } 
    }
  }
}

task translateResources(type:Exec) {
  workingDir projectDir
  commandLine 'omegat', getProjectDir().toString(), '--mode=console-translate'
}

processResourceFiles.dependsOn translateResources
processResources.dependsOn processResourceFiles
processPropertiesFile.dependsOn processResourceFiles

processResources.excludes = ['**/*.properties']
processResources.dependsOn processPropertiesFile

task wrapper(type: Wrapper) {
  gradleVersion = '2.12'
}
